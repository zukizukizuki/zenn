---
title: "Check the status of the database if this condition persists ãŒå‡ºã‚‹"
emoji: "ğŸ›¼"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [aws, rds, error, error]
published: true
---

## ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
```
[WARN] Database "dev-db-01" at 172.31.0.167:3306 became unavailable for access from 172.31.0.8. Check the status of the database if this condition persists.
```

## åŸå› 
ã“ã®ã‚¨ãƒ©ãƒ¼ã¯ã€RDSãƒ—ãƒ­ã‚­ã‚·ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«æ¥ç¶šã§ããªã„å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚

## å¯¾å‡¦æ–¹æ³•
1. RDSã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®çŠ¶æ…‹ç¢ºèª
   - AWS CLIã¾ãŸã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§RDSã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®çŠ¶æ…‹ã‚’ç¢ºèª:
   ```
   aws rds describe-db-instances --db-instance-identifier dev-db-01 --query 'DBInstances[0].DBInstanceStatus'
   ```

2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®è¨­å®šç¢ºèª
   - RDSã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨RDSãƒ—ãƒ­ã‚­ã‚·ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç¢ºèª:
   ```
   resource "aws_security_group_rule" "rds_proxy_to_rds" {
     type                     = "ingress"
     from_port                = 3306
     to_port                  = 3306
     protocol                 = "tcp"
     source_security_group_id = aws_security_group.rds_proxy.id
     security_group_id        = aws_security_group.rds.id
   }
   ```

3. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã®ç¢ºèª
   - RDSã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€RDSãƒ—ãƒ­ã‚­ã‚·ã€Lambdaé–¢æ•°ãŒåŒã˜VPCã¨ã‚µãƒ–ãƒãƒƒãƒˆã«ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
   - å¿…è¦ã«å¿œã˜ã¦VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®š

4. RDSãƒ—ãƒ­ã‚­ã‚·ã®ãƒ­ã‚°ç¢ºèª
   - ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’æœ‰åŠ¹ã«ã—ã¦è©³ç´°ãªæƒ…å ±ã‚’å–å¾—:
   ```
   resource "aws_db_proxy" "rds_proxy_db_dump" {
     # ä»–ã®è¨­å®š...
     debug_logging = true
   }
   ```

ã“ã‚Œã‚‰ã®å¯¾å‡¦æ–¹æ³•ã‚’é †ç•ªã«è©¦ã™ã“ã¨ã§ã€å¤šãã®æ¥ç¶šå•é¡Œã‚’è§£æ±ºã§ãã¾ã™ã€‚å•é¡ŒãŒè§£æ±ºã—ãªã„å ´åˆã¯ã€AWS Supportã«é€£çµ¡ã™ã‚‹ã‹ã€ã‚ˆã‚Šè©³ç´°ãªãƒ­ã‚°åˆ†æãŒå¿…è¦ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
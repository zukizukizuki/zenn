---
title: "ã€AWSã€‘certificate verify failed\: unable to get local issuer certificate (_ssl.c\:1006)) ãŒå‡ºã‚‹"
emoji: "ğŸ”˜"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [aws, rds, error, error]
published: true
---


## ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
RDSãƒ—ãƒ­ã‚­ã‚·ã«ã¦

```
Database error: (2003, "Can't connect to MySQL server on 'dev-proxy-db-01.XXX.ap-northeast-1.rds.amazonaws.com' ([SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1006))")
```
ãŒå‡ºã‚‹


## åŸå› 
ã“ã®ã‚¨ãƒ©ãƒ¼ã¯ã€SSLè¨¼æ˜æ›¸ã®æ¤œè¨¼ã«å¤±æ•—ã—ãŸå ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚

## å¯¾å‡¦æ–¹æ³•
1. æ­£ã—ã„è¨¼æ˜æ›¸ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨ä½¿ç”¨
   - æœ€æ–°ã®RDSè¨¼æ˜æ›¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰:
   ```
   wget https://truststore.pki.rds.amazonaws.com/global/global-bundle.pem -O rds-ca-2019-root.pem
   ```
   - S3ãƒã‚±ãƒƒãƒˆã«è¨¼æ˜æ›¸ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰:
   ```
   resource "aws_s3_object" "rds_ca_cert" {
     bucket = aws_s3_bucket.lambda_bucket.bucket
     key    = "rds-ca-2019-root.pem"
     source = "${path.module}/rds-ca-2019-root.pem"
   }
   ```

2. Lambdaé–¢æ•°ã‚³ãƒ¼ãƒ‰ã®ä¿®æ­£
   - SSL contextã®è¨­å®šã‚’é©åˆ‡ã«è¡Œã†:
   ```
   ssl_context = ssl.create_default_context(cafile=temp_cert_file.name)
   ssl_context.check_hostname = False
   ssl_context.verify_mode = ssl.CERT_REQUIRED
   ```

3. RDSãƒ—ãƒ­ã‚­ã‚·ã®è¨­å®šç¢ºèª
   - `require_tls`ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª:
   ```
   resource "aws_db_proxy" "rds_proxy_db_dump" {
     # ä»–ã®è¨­å®š...
     require_tls = true
   }
   ```

---
title: "distrolessイメージ vs 一般的なDockerイメージ - セキュリティリスクと実例から学ぶ"
emoji: "👮‍♂️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [docker , distroless, セキュリティ , コンテナ]
published: true
---

distrolessイメージと一般的なDockerイメージの違いを、実際のセキュリティインシデントを交えて解説します。

## 一般的なDockerイメージ

- UbuntuやAlpineなど、フルのLinuxディストリビューションをベースにしています。
- パッケージマネージャー、シェル、各種ユーティリティツールが含まれています。
- 開発やデバッグが容易で、柔軟性が高いのが特徴です。

## distrolessイメージ

- アプリケーションと最小限のランタイム環境のみを含む超軽量イメージです。
- パッケージマネージャーやシェルなどの一般的なツールは省略されています。
- セキュリティと効率性を重視しています。
- Chainguard社が提供するdistrolessイメージは、さらにセキュリティを強化し、最適化されています。

## 一般的なDockerイメージが標的になった例

### 事例1: 2018年のTesla社へのサイバー攻撃

攻撃者は、パスワードで保護されていないKubernetesコンソールを発見。
悪意のあるコンテナをデプロイし、Teslaの社内システムに侵入。
結果、機密データが流出し、会社のクラウドリソースで暗号通貨のマイニングが行われました。
この事例から、不要なツールや権限を持つコンテナが攻撃者に悪用される危険性が分かります。

参考：https://japan.cnet.com/article/35114995/

### 事例2: Alpine Linux Dockerイメージの脆弱性

Alpine Linux の公式 Docker イメージに、約3年間にわたって空のルートパスワードが設定されていたことが発覚。
この脆弱性により、攻撃者がコンテナ内で容易に root 権限を取得できる可能性がありました。
影響を受けたバージョンは、Alpine Linux 3.3から3.9までの全てのオフィシャルイメージ。
この脆弱性は、数百万のコンテナに影響を与えた可能性があります。
この事例は、広く使用されているベースイメージでさえもセキュリティ上の問題を含む可能性があることが判明しました。

参考：https://jp.tenable.com/blog/cve-2019-5021-hard-coded-null-root-password-found-in-alpine-linux-docker-images

### 事例3: 2021年のAzure Container Instancesへの侵入（Unit 42による発見）

Palo Alto NetworksのUnit 42チームが、Microsoft Azure Container Instancesの脆弱性を発見。
攻撃者は、他のユーザーのコンテナにアクセスし、機密情報を盗む可能性がありました。
この脆弱性は「Azurescape」と名付けられ、コンテナエスケープの深刻な例となりました。
この事例は、クラウドプロバイダーが管理するコンテナ環境でも重大な脆弱性が存在し得ることを示しています。適切な分離とセキュリティ対策の重要性が再認識されました。

参考：https://unit42.paloaltonetworks.jp/azure-container-instances/

## 両者の比較

### セキュリティ

- 一般的なDockerイメージ：多くのツールが含まれ、攻撃対象が多くなります。
- distrolessイメージ：最小限の構成で、攻撃対象が大幅に減少します。

### イメージサイズ

- 一般的なDockerイメージ：数百MB〜1GB以上
- distrolessイメージ：数十MB程度

### メンテナンス

- 一般的なDockerイメージ：多くのパッケージの更新が必要
- distrolessイメージ：更新頻度が低く、管理が容易

### 開発とデバッグ

- 一般的なDockerイメージ：標準ツールで開発やデバッグが容易
- distrolessイメージ：特殊な方法が必要で、デバッグが難しい場合も

## 結論

distrolessイメージはセキュリティを重視する本番環境に適しており、一般的なDockerイメージは開発環境や柔軟性が必要な場合に適しています。
セキュリティインシデントから学んだように、必要最小限の構成でコンテナを運用することが、リスクの軽減につながります。プロジェクトの要件に応じて、適切なイメージタイプを選択しましょう。
Chainguard社のdistrolessイメージは、この分野でのリーダー的存在であり、高度なセキュリティと最適化を提供しています。セキュリティを重視するプロジェクトでは、Chainguardのイメージを検討する価値があります。